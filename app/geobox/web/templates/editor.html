{% extends "base_map.html" %}
{% from "form_macros.html" import select, input %}

{% block title %}{{ _('editor') }}{% endblock %}

{% block project_js %}
  <!-- JSTS for split and union -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/javascript.util.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/jsts.js') }}"></script>

  <!-- Proj4 for transformation -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/proj4js-compressed.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/proj4js.defs.js') }}"></script>

  <!-- slider and colorpicker for styleeditor -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/jquery.nouislider.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/jquery.minicolor.js') }}"></script>

  <!-- jquery ui custom for sortable in featureattributelistconfigurator -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/lib/widgets/jquery-ui-1.10.3.custom.min.js') }}"></script>
  <!-- widgets -->
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/layermanager.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/measure.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/attribute.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/styleeditor.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/pointstyleeditor.js') }}"></script>

  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/filter.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/thematicalvector.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/thematicalvectorconfigurator.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/thematicalvectorlegend.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/widgets/thematicalvectorattributelist.js') }}"></script>

{% endblock %}

{% block map_js %}

   <script type="text/javascript">
      OpenLayers.ProxyHost = "{{ url_for('proxy.proxy_request') }}";
      var exportODSURL = "{{ url_for('.export_list', export_type='ods') }}";
      var exportCSVURL = "{{ url_for('.export_list', export_type='csv') }}";
      {{ generate_base_layer(base_layer) }}
      {{ generate_sources(sources, cache_url, coverages=False)}}
      {{ generate_couch_layers(couch_layers, 'true', True)}}

      {% if preview_layername and preview_features %}
        {{ generate_temp_vectorlayer(preview_layername, preview_features)}}
      {% endif %}
   </script>
   <script type="text/javascript" src="{{ url_for('static', filename='js/views/editor.js') }}"></script>
{% endblock %}

{% block content %}
<div class="row-fluid">
    <h1>{{_('editor')}}
      {{ generate_tooltip(_('tooltip - editor') ) }}
    </h1>

    <div class="span8 map" id='map'></div>
    <div class="span4">
      <div class="bs-docs-example">
        <ul id="tabs" class="nav nav-tabs">
          <li class="active">
            <a href="#layermanager" data-toggle="tab">{{ _('map layer') }}</a>
          </li>
          <li>
            <a href="#layer" data-toggle="tab">{{ _('look') }}</a>
          </li>
          <li>
            <a href="#edit" data-toggle="tab">{{ _('edit') }}</a>
          </li>
          <li>
            <a href="#filter" data-toggle="tab">{{ _('filter') }}</a>
          </li>
          <li>
            <a href="#measure" data-toggle="tab">{{ _('measure') }}</a>
          </li>
          <li>
            <a href="#thematical" data-toggle="tab">{{ _('thematical map') }}</a>
          </li>
          <li>
            <a href="#save" id="save-tab" data-toggle="tab">{{ _('save & load') }}</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade in active" id="layermanager">
          <!-- load layermanager widget -->
          </div>

          <div class="tab-pane fade" id="layer">
            <h4>{{ _('Styling') }}</h4>
            <p>{{ _('infotext - edit styling') }}</p>
            <div id="style-editor"></div>
          </div>

          <div class="tab-pane fade" id="edit">
            <h4>{{ _('Edit') }}</h4>
            <p>{{ _('infotext - edit controls') }}</p>
            <div id="edit-toolbar" class="span12">
            </div>

            <div class="span12">
              <button id="select_all_features" class="btn btn-small">{{ _('select all features') }}</button>
            </div>

           <div>
            <ul id="editor-tabs" class="nav nav-tabs">
              <li class="active">
                  <a id="attributeTab" href="#attributes" data-toggle="tab">
                    {{ _('Attribute') }}</a>
                </li>
                <li>
                  <a id="pointTab" href="#point_stling" data-toggle="tab" style="display:none">{{ _('point styling') }}</a>
                </li>
            </ul>
              <div class="tab-content">
                <div class="tab-pane fade in active" id="attributes">
                  <h4>{{ _('Attributes') }}</h4>
                  <p>{{ _('infotext - attributes') }}</p>
                  <div id="attributemanager"></div>
                </div>
                <div class="tab-pane fade" id="point_stling">
                  <div id="point-style-editor"></div>
                </div>
             </div>
            </div>
          </div>
          <div class="tab-pane fade" id="filter">
            <h4>{{ _('filter') }}</h4>
            <p>{{ _('infotext - filter controls') }}</p>
            <div id="filtermanager"></div>
          </div>

          <div class="tab-pane fade" id="measure">
            <h4>{{ _('Measure') }}</h4>
            <p>{{ _('infotext - measure controls') }}</p>
            <div id="measure-toolbar">
            <!--  load measure widget -->
            </div>
            <div id="measure-output">
            </div>
          </div>

          <div class="tab-pane fade" id="thematical">
            <h4>{{ _('thematical map') }}</h4>
            <p>{{ _('infotext - thematical map') }}</p>
            <div id="thematical-vector"></div>
          </div>

          <div class="tab-pane fade" id="save">
            <h4>{{ _('save changes') }}</h4>
            <p>{{ _('infotext - editor save') }}</p>
            <hr>
            <h5>{{ _('save') }}</h5>
            <button class="btn btn-small" id="save-changes" disabled="disabled">{{ _('save') }}</button>
            <button class="btn btn-small" id="discard-changes" disabled="disabled">{{ _('discard') }}</button>
            <hr>
            <h5>{{ _('save as') }}</h5>
            <div class="input-append">
                <input class="span5" id="save-as-name" name="save-as-name" type="text">
                <button class="btn btn-small" id="save-as" type="button">{{ _('save as') }}</button>
            </div>
            <hr>
            <h4>{{ _('savepoints') }}</h4>
            <h5>{{ _('create savepoint') }}</h5>
            <button class="btn btn-small" id="create-savepoint" type="button">{{ _('create new savepoint') }}</button>
            <span id="save-msg-success" class="span11 alert alert-success hide">{{_('save point created')}}</span>
            <span id="save-msg-error" class="span11 alert alert-error hide">{{_('error - could not create savepoint')}}</span>
            <div id="show-savepoints" class="hide">
              <h5>{{ _('load savepoint') }}</h5>
                <select id="select-savepoints" class="span6"></select>
                <div class="input-append">
                  <button id="load-savepoint-modal" class="btn btn-small">{{ _('load') }}</button>
                  <button id="delete-savepoint-modal" class="btn btn-small">{{ _('delete') }}</button>
                </div>
            </div>
        </div>
      </div>
    </div>

    <!-- modal for load savepoint -->
    <div id="loadSavepointModal" class="modal hide">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{{_('Sure you want load savepoint')}}?</h3>
      </div>
      <div class="modal-body">
        <p>{{ _('infotext load savepoint') }}</p>
      </div>
      <div class="modal-footer">
        <a href="#" id="abort_load_savepoint" class="btn" data-dismiss="modal">{{_('abort')}}</a>
        <a href="#" id="load-savepoint" class="btn btn-primary">{{_('yes load')}}</a>      </div>
    </div>

    <!-- modal for delete savepoint -->
    <div id="deleteSavepointModal" class="modal hide">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{{_('Sure you want remove savepoint')}}?</h3>
      </div>
      <div class="modal-body">
        <p>{{ _('infotext remove savepoint') }}</p>
      </div>
      <div class="modal-footer">
        <a href="#" id="abort_remove_savepoint" class="btn" data-dismiss="modal">{{_('abort')}}</a>
        <a href="#" id="delete-savepoint" class="btn btn-primary">{{_('yes delete')}}</a>
      </div>
    </div>


    <!-- modal for change layer -->
    <div id="changeVectorLayer" class="modal hide">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{{_('Sure you want change layer')}}?</h3>
      </div>
      <div class="modal-body">
        <p>{{ _('infotext change layer') }}</p>
      </div>
      <div class="modal-footer">
        <a href="#" id="abort_change_layer" class="btn" data-dismiss="modal">{{_('abort')}}</a>
        <a href="#" id="change_layer_discard" class="btn btn-primary">{{_('yes change and discard')}}</a>
        <a href="#" id="change_layer_save" class="btn btn-primary">{{_('yes change and save')}}</a>
      </div>
    </div>

    <!-- modal for delete -->
    <div id="deleteVectorLayer" class="modal hide">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{{_('Sure you want delete layer')}} <span id="layer_title"></span>?</h3>
      </div>
      <div class="modal-body">
        <p>{{ _('infotext delete layer') }}</p>
      </div>
      <div class="modal-footer">
        <a href="#" id="abort_remove_layer" class="btn" data-dismiss="modal">{{_('abort')}}</a>
        <a href="#" id="remove_layer" class="btn btn-primary">{{_('yes delete')}}</a>
      </div>
    </div>

    <!-- modal for export -->
    <div id="exportVectorLayer" class="modal hide">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h3>{{_('export vector layer')}} </h3>
      </div>
      <form action="{{ url_for('vector.export_vector')}}" method="POST">
        <div class="modal-body">
          <p>{{ _('infotext export layer') }}</p>
          {{ export_form.name }}
          {{ select(export_form.export_type) }}
          {{ select(export_form.srs) }}
          {{ select(export_form.destination) }}
        </div>
        <div class="modal-footer">
          <a href="#" id="abort_export_layer" class="btn" data-dismiss="modal">{{_('abort')}}</a>
          <button class="btn btn-primary" type="submit">{{_('export')}}</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
